webpackJsonp([3],{D9PO:function(e,t,n){"use strict";var s=n("mvHQ"),o=n.n(s),i=n("Ozlq"),r=n("vLgD");var a={name:"SaveQuestion",data:function(){return{categoryList:[],inputVisible:!1,questionForm:{caption:"",content:"",category_id:null},questionRules:{caption:[{required:!0,message:"问题标题不能为空"}]}}},created:function(){var e=this;if(this.hasQuestion){var t=this.question,n=this.questionForm;n.caption=t.caption,n.content=t.content}Object(r.a)({url:"/getCategoryList",method:"get"}).then(function(t){console.log(t),1e3!==t.code?e.$message({showClose:!0,message:t.message,type:"error"}):e.categoryList=t.data})},methods:{handleSaveQuestion:function(){var e=this;this.$refs.questionForm.validate(function(t){if(t){var n=JSON.parse(o()(e.questionForm));Object(i.d)(n).then(function(t){console.log(t.data),t.data>0&&e.$router.push({path:"/question",query:{question_id:t.data}})})}})},handleUpdateQuestion:function(){var e=this;this.$refs.questionForm.validate(function(t){if(t){var n=JSON.parse(o()(e.questionForm));n.questionId=e.question.questionId,Object(i.e)(n).then(function(t){!0===t&&e.$emit("updateQuestion",n)})}})},showInput:function(){var e=this;this.inputVisible=!0,this.$nextTick(function(t){e.$refs.topic.$refs.input.focus()})}},computed:{hasQuestion:function(){return null!=this.question}},props:["question"]},u={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-form",{ref:"questionForm",staticClass:"questionForm",attrs:{model:e.questionForm,rules:e.questionRules,"label-width":"100px","label-position":"left"}},[n("el-form-item",{attrs:{label:"标题",prop:"caption"}},[n("el-input",{model:{value:e.questionForm.caption,callback:function(t){e.$set(e.questionForm,"caption",t)},expression:"questionForm.caption"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"问题描述",prop:"content"}},[n("el-input",{attrs:{type:"textarea"},model:{value:e.questionForm.content,callback:function(t){e.$set(e.questionForm,"content",t)},expression:"questionForm.content"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"分类",prop:"categoryList"}},[n("el-select",{staticStyle:{display:"block"},attrs:{placeholder:"请选择"},model:{value:e.questionForm.category_id,callback:function(t){e.$set(e.questionForm,"category_id",t)},expression:"questionForm.category_id"}},e._l(e.categoryList,function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),e.hasQuestion?n("el-button",{attrs:{type:"primary"},on:{click:e.handleUpdateQuestion}},[e._v("修改问题")]):n("el-button",{attrs:{type:"primary"},on:{click:e.handleSaveQuestion}},[e._v("提问")])],1)],1)},staticRenderFns:[]};var l=n("VU/8")(a,u,!1,function(e){n("j2np")},"data-v-3397250e",null);t.a=l.exports},NtIj:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n("Ozlq"),o=n("Muk+"),i=n("yw6p"),r=n("V7I/"),a={name:"answer",components:{userInfo:i.a,attitude:r.a},data:function(){return{answer:this.answerInfo.answer}},created:function(){},methods:{handleDeleteAnswer:function(){this.$emit("handleDeleteAnswer")},preAnswer:function(){this.$emit("preAnswer")}},computed:{isAdmin:function(){return this.$store.getters.authority>1}},props:["answerInfo","answered","questioned"]},u={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",[n("userInfo",{attrs:{userInfo:e.answerInfo.userInfo}})],1),e._v(" "),n("div",{staticClass:"answer",domProps:{innerHTML:e._s(e.answer.ans)}}),e._v(" "),n("div",{staticClass:"gmt_create",staticStyle:{"margin-top":"10px"}},[e._v("回答于 "+e._s(e.$getTimeString(null!=e.answer.gmtModify?e.answer.gmtModify:e.answer.gmtCreate)))]),e._v(" "),n("div",{staticStyle:{"margin-top":"10px"}},[n("attitude",{attrs:{answerInfo:e.answerInfo}}),e._v(" "),n("span",{staticStyle:{"margin-left":"10px"}},[e.answered?n("el-button",{staticStyle:{color:"gray"},attrs:{type:"text",icon:"el-icon-edit-outline"},on:{click:e.preAnswer}},[e._v("修改")]):e._e(),e._v(" "),e.answered||e.isAdmin?n("el-button",{staticStyle:{color:"red"},attrs:{type:"text",icon:"el-icon-delete"},on:{click:e.handleDeleteAnswer}},[e._v("删除")]):e._e()],1)],1),e._v(" "),n("el-divider",{staticClass:"divider"})],1)},staticRenderFns:[]};var l=n("VU/8")(a,u,!1,function(e){n("PPd2")},null,null).exports,c=n("D9PO"),d={data:function(){return{questionInfo:{questionID:this.$route.query.question_id,question:{anonymous:!1,caption:null,content:null,gmtCreate:0,gmtModify:null,userID:null},subscribed:!1,subscribeCount:0,viewCount:0,questioned:!1,defaultAnswer:null,userAnswer:null},answerSet:{},answerInfos:[],answer:{userID:null,questionID:null,answerID:null,ans:null,anonymous:!1,gmtCreate:0,gmtModify:null},showAnswerDrawer:!1,showQuestion:!1}},components:{Answer:l,UserInfo:i.a,SaveQuestion:c.a},created:function(){var e=this,t=this.$route.query.question_id;console.log(this.$route.query.question_id),null!=t&&Object(s.b)(t).then(function(t){console.log(t.data),console.log(e.questionInfo),e.questionInfo.question=t.data,null!=e.questionInfo.userAnswer&&(e.answer=e.questionInfo.userAnswer.answer),Object(o.c)(e.$route.query.question_id).then(function(t){console.log(t.data);for(var n=t.data,s=e.answerInfos.total_count,o=0;o<n.length;++o){var i=n[o];if(null!=e.questionInfo.defaultAnswer&&i.answer.answerId===e.questionInfo.defaultAnswer.answer.answerId)e.questionInfo.defaultAnswer=i;else if(null!=e.questionInfo.userAnswer&&i.answer.answerId===e.questionInfo.userAnswer.answer.answerId)e.questionInfo.userAnswer=i;else{var r=""+i.answer.answerId;e.answerSet.hasOwnProperty(r)?e.answerInfos[e.answerSet[r]]=i:(e.answerInfos.push(i),e.answerSet[r]=s++)}}})})},methods:{handleDeleteAnswer:function(){var e=this,t={answerId:this.answer.answerId};Object(o.a)(t).then(function(t){!0===t&&(e.questionInfo.userAnswer=null,e.answer.answerId=null,e.$message({showClose:!0,message:"删除成功",type:"success"}))})},handleAnswer:function(){var e=this;this.answer.userId=this.userId,this.answer.questionId=this.questionInfo.question.questionId,null!=this.answer.answerId?Object(o.e)(this.answer).then(function(t){!0===t&&(e.answer.gmtModify=e.$nowTimestamp(),e.questionInfo.userAnswer.answer=e.answer,e.questionInfo.userAnswer.userInfo=e.$userInfo(e.answer.anonymous),e.showAnswerDrawer=!1)}):Object(o.d)(this.answer).then(function(t){var n=Number(t);if(n>0){e.answer.answerId=n,e.answer.gmtCreate=e.$nowTimestamp();var s={answer:e.answer,against:0,agree:0,attituded:null,userInfo:e.$userInfo(e.answer.anonymous)};e.questionInfo.userAnswer=s,e.showAnswerDrawer=!1}})},updateQuestion:function(e){this.questionInfo.question=e,this.showQuestion=!1},handleDeleteQuestion:function(){var e=this,t={questionId:this.$route.query.questionId};Object(s.a)(t).then(function(t){!0===t&&e.$router.push({path:"/"})})}},computed:{userID:function(){return this.$store.getters.userID}}},f={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{"text-align":"left"}},[n("div",{staticStyle:{float:"left"}},e._l(e.questionInfo.question.topics,function(e){return n("TopicTag",{key:e,attrs:{topic:e}})}),1),e._v(" "),n("div",{staticStyle:{float:"right"}},[e.questionInfo.subscribed?n("el-button",{attrs:{type:"text",icon:"el-icon-star-on"},on:{click:e.handleSubscribe}}):n("el-button",{attrs:{type:"text",icon:"el-icon-star-off"},on:{click:e.handleSubscribe}}),e._v(" "),n("el-button",{staticClass:"subscribe_btn",staticStyle:{"margin-left":"0"},attrs:{type:"text"}},[e._v(e._s(e.questionInfo.subscribeCount))]),e._v(" "),n("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),n("i",{staticClass:"el-icon-view"}),e._v(" "),n("span",{staticClass:"viewed"},[e._v(e._s(e.questionInfo.viewCount))]),e._v(" "),n("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),n("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(t){e.showAnswerDrawer=!0}}},[e._v("回答")])],1),e._v(" "),n("h1",{staticStyle:{clear:"both"}},[e._v(e._s(e.questionInfo.question.caption))]),e._v(" "),n("div",{staticStyle:{color:"gray","font-size":"10px","margin-top":"10px"}},[e._v("问题描述：")]),e._v(" "),n("div",{domProps:{innerHTML:e._s(e.questionInfo.question.content)}}),e._v(" "),null!=e.questionInfo.defaultAnswer||null!=e.questionInfo.userAnswer?n("el-card",{staticStyle:{"margin-top":"10px"},attrs:{"body-style":{padding:"10px"}}},[null!=e.questionInfo.defaultAnswer?n("div",[n("answer",{attrs:{answerInfo:e.questionInfo.defaultAnswer,answered:!1,questioned:e.questionInfo.questioned},on:{handleDeleteAnswer:e.handleDeleteAnswer}})],1):e._e(),e._v(" "),null!=e.questionInfo.userAnswer?n("div",[n("answer",{attrs:{answerInfo:e.questionInfo.userAnswer,answered:!0,questioned:e.questionInfo.questioned},on:{handleDeleteAnswer:e.handleDeleteAnswer,preAnswer:function(t){e.showAnswerDrawer=!0}}})],1):e._e()]):e._e(),e._v(" "),n("el-card",{attrs:{"body-style":{padding:"10px"}}},[n("el-divider",{staticClass:"divider"},[e._v(e._s(0===e.answerInfos.length?"暂无其他回答":"更多"+e.answerInfos.length+"个回答"))]),e._v(" "),e._l(e.answerInfos,function(t){return[n("div",{key:t.answer.answerId,staticStyle:{"text-align":"left"}},[n("answer",{attrs:{answerInfo:t,answered:!1,questioned:e.questionInfo.questioned}})],1)]})],2),e._v(" "),n("el-drawer",{staticStyle:{"text-align":"center"},attrs:{visible:e.showAnswerDrawer,size:"70%",direction:"btt"},on:{"update:visible":function(t){e.showAnswerDrawer=t}}},[n("el-row",{attrs:{type:"flex",justify:"center"}},[n("el-col",{attrs:{span:20}},[n("el-input",{attrs:{type:"textarea",placeholder:"请输入回答",autosize:{minRows:8,maxRows:10}},model:{value:e.answer.ans,callback:function(t){e.$set(e.answer,"ans",t)},expression:"answer.ans"}})],1)],1),e._v(" "),n("el-checkbox",{model:{value:e.answer.anonymous,callback:function(t){e.$set(e.answer,"anonymous",t)},expression:"answer.anonymous"}},[e._v("开启匿名")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.handleAnswer}},[e._v("提交")])],1),e._v(" "),n("el-dialog",{attrs:{visible:e.showQuestion},on:{"update:visible":function(t){e.showQuestion=t}}},[e.showQuestion?n("SaveQuestion",{attrs:{question:e.questionInfo.question},on:{updateQuestion:e.updateQuestion}}):e._e()],1)],1)},staticRenderFns:[]};var w=n("VU/8")(d,f,!1,function(e){n("nG29")},null,null);t.default=w.exports},PPd2:function(e,t){},j2np:function(e,t){},nG29:function(e,t){}});
//# sourceMappingURL=3.ee7262966273b6bf379a.js.map