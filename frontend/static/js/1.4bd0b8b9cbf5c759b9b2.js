webpackJsonp([1],{"3iTu":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=s("vMJZ"),i=s("BO1k"),r=s.n(i),o=s("d7EF"),a=s.n(o),u=s("mvHQ"),l=s.n(u),c={name:"Chat",data:function(){return{msg:"",userInfo:null,userInfos:[],messages:[]}},components:{userInfoSmall:s("HUQg").a},methods:{handleSendMessage:function(){var t={dstId:this.dstId,msg:this.msg};this.chatWebSocket.send(l()(t)),this.msg="",this.messages=this.$store.getters.messageGroup.get(this.dstId)},messageStyle:function(t){return{color:t?"blue":"green"}},updateMessages:function(){var t=this,e=this.$store.getters.messageGroup,s=[],i=!0,o=!1,u=void 0;try{for(var l,c=r()(e);!(i=(l=c.next()).done);i=!0){var f=l.value,d=a()(f,2),h=d[0];d[1];s.push(h)}}catch(t){o=!0,u=t}finally{try{!i&&c.return&&c.return()}finally{if(o)throw u}}Object(n.i)(s).then(function(e){t.userInfos=e}),this.dstId&&(this.messages=this.$store.getters.messageGroup.get(this.dstId))}},created:function(){this.peopleUserInfo&&(this.userInfo=this.peopleUserInfo),this.updateMessages()},computed:{userId:function(){return this.$store.getters.userId},chatWebSocket:function(){return this.$store.getters.chatWebSocket},dstId:function(){return this.userInfo?this.userInfo.user.userId:null},nickname:function(){return this.$store.getters.user.nickname},valueChange:function(){return this.$store.getters.valueChange}},watch:{dstId:function(t){t&&(this.messages=this.$store.getters.messageGroup.get(t))},valueChange:function(t){this.updateMessages()},messages:function(t){var e=this;setTimeout(function(){var t=e.$refs.messages;t.scrollTop=t.scrollHeight},500)}},props:["peopleUserInfo"]},f={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticStyle:{width:"600px","background-color":"white",height:"600px"}},[s("div",{staticClass:"userInfos_div"},t._l(t.userInfos,function(e){return s("div",{key:e.user.userId,staticClass:"userInfos_div_div",on:{click:function(s){t.userInfo=e}}},[s("div",[s("userInfoSmall",{staticStyle:{"margin-top":"10px"},attrs:{userInfo:e}})],1)])}),0),t._v(" "),t.userInfo?s("el-card",{staticClass:"chat_card",attrs:{"body-style":{padding:"10px"}}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[t._v(t._s(t.userInfo.user.nickname))])]),t._v(" "),s("div",{ref:"messages",staticClass:"message_div"},t._l(t.messages,function(e,n){return s("div",{key:n},[s("div",{staticStyle:{"text-align":"left","margin-top":"10px"},style:t.messageStyle(e.dstId===t.userId)},[s("div",[t._v(t._s(e.dstId===t.userId?t.userInfo.user.nickname:t.nickname)+" "+t._s(t.$getTimeString(e.gmtCreate)))]),t._v(" "),s("div",[t._v(t._s(e.msg))])])])}),0),t._v(" "),s("div",{staticStyle:{"margin-top":"10px"}},[s("el-input",{staticStyle:{float:"left",width:"300px"},attrs:{placeholder:"聊天内容"},model:{value:t.msg,callback:function(e){t.msg=e},expression:"msg"}}),t._v(" "),s("el-button",{staticStyle:{float:"right"},on:{click:t.handleSendMessage}},[t._v("发送")])],1)]):t._e()],1)},staticRenderFns:[]};var d=s("VU/8")(c,f,!1,function(t){s("SwPm")},"data-v-ffcae902",null).exports,h=s("kX6x"),v={name:"people",data:function(){return{userInfo:null,loading:!1,subscribeQuestions:[],activityInfos:[],questionInfos:[],page:0,limit:10,colors:["#DD0000","brown","#0000DD","#48B753","#DDA522","green"],userInfos:[],tabindex:"0",firstLoadUserInfos:!1,firstLoadFollowerInfos:!1,showChat:!1}},components:{ActivityInfo:s("5KsW").a,Chat:d,UserInfoTable:h.a},created:function(){this.init()},methods:{init:function(){var t=this;null!=this.peopleId&&(this.userInfo=null,this.loading=!1,this.page=0,this.activityInfos=[],this.userInfos=[],this.firstLoadUserInfos=!1,this.firstLoadFollowerInfos=!1,Object(n.b)({peopleId:this.peopleId}).then(function(e){t.userInfo=e}))},load:function(){var t=this;if(!this.loading){this.loading=!0;var e={peopleId:this.peopleId,page:this.page,limit:this.limit};Object(n.f)(e).then(function(e){t.activityInfos=t.activityInfos.concat(e),++t.page,e.length<t.limit?(console.log("暂时没有更多了"),setTimeout(function(){t.loading=!1,console.log("冷却完成")},1e3)):t.loading=!1})}},handleFollow:function(){var t=this,e={peopleId:this.peopleId};this.userInfo.followed?Object(n.a)(e).then(function(e){!0===e&&(--t.userInfo.followersCount,t.userInfo.followed=!1)}):Object(n.k)(e).then(function(e){!0===e&&(++t.userInfo.followersCount,t.userInfo.followed=!0)})},handleSelect:function(t,e){this.tabindex=t},handleOpenChat:function(){this.$store.commit("readMessage"),this.showChat=!0},handleCloseChat:function(){this.$store.commit("closeMessage"),this.showChat=!1},handleUpdateAuthority:function(t){var e=this,s={userId:this.peopleId,authority:t};Object(n.m)(s).then(function(s){!0===s&&(e.userInfo.user.authority=t)})}},computed:{questionActivityInfos:function(){var t=this,e=[];return this.questionInfos.forEach(function(s){var n=t.$questionInfo2ActvityInfo(s);e.push(n)}),e},isSuperAdmin:function(){return 2===this.$store.getters.authority},avaterUrl:function(){return this.$avaterUrl(this.userInfo.user.avater,this.userInfo.user.userId)},userId:function(){return this.$store.getters.userId},sexStr:function(){if(this.isMe)return"我";switch(this.userInfo.user.sex){case 0:return"他";case 1:return"她";default:return"ta"}},peopleId:function(){return Number(this.$route.params.peopleId)},isMe:function(){return this.peopleId===this.userId},menu:function(){return["动态","回答","提问","订阅","关注"+this.sexStr+"的",this.sexStr+"关注的"]}},watch:{tabindex:function(t){var e=this,s={peopleId:this.peopleId};this.page=0,"1"===t?Object(n.d)(s).then(function(t){e.questionInfos=t}):"2"===t?Object(n.g)(s).then(function(t){e.questionInfos=t}):"3"===t?Object(n.h)(s).then(function(t){e.subscribeQuestions=t}):"4"===t?Object(n.e)(s).then(function(t){e.userInfos=t}):"5"===t?Object(n.j)(s).then(function(t){e.userInfos=t}):this.userInfos=[]},peopleId:function(t){this.init()}}},p={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return null!=t.userInfo?s("div",{staticStyle:{"text-align":"left"}},[s("div",{staticClass:"user_card",staticStyle:{"font-size":"15px"}},[s("div",{staticClass:"user_avater_border"},[s("img",{staticClass:"user_avater",attrs:{src:t.avaterUrl}})]),t._v(" "),s("div",{staticStyle:{width:"612px",float:"left",padding:"10px 0 10px"}},[s("el-dropdown",{staticStyle:{float:"right","margin-right":"20px"},attrs:{"show-timeout":0,trigger:"click"}},[s("span",[s("i",{staticClass:"el-icon-more",staticStyle:{color:"gray",cursor:"pointer","line-height":"50px"}})]),t._v(" "),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t.isSuperAdmin&&1===t.userInfo.user.authority?s("el-dropdown-item",{nativeOn:{click:function(e){return t.handleUpdateAuthority(0)}}},[t._v("取消社区管理员")]):t._e(),t._v(" "),t.isSuperAdmin&&0===t.userInfo.user.authority?s("el-dropdown-item",{nativeOn:{click:function(e){return t.handleUpdateAuthority(1)}}},[t._v("设为社区管理员")]):t._e(),t._v(" "),s("el-dropdown-item",{nativeOn:{click:function(e){return t.handleFollow(e)}}},[t._v(t._s(t.userInfo.followed?"已":"")+"关注")]),t._v(" "),s("el-dropdown-item",{nativeOn:{click:function(e){return t.handleOpenChat(e)}}},[t._v("发消息")])],1)],1),t._v(" "),s("div",[s("div",{staticStyle:{float:"right","text-align":"center",width:"200px"}},[s("div",{staticClass:"follow_div",staticStyle:{width:"99px","border-right":"1px solid #ebebeb"}},[s("div",[t._v("关注"+t._s(t.sexStr))]),t._v(" "),s("el-tooltip",{attrs:{content:""+t.userInfo.followersCount,placement:"left-start"}},[s("b",{staticClass:"follow_div_b"},[t._v(t._s(t.userInfo.followersCount))])])],1),t._v(" "),s("div",{staticClass:"follow_div",staticStyle:{width:"100px"}},[s("div",[t._v(t._s(t.sexStr)+"关注")]),t._v(" "),s("el-tooltip",{attrs:{content:""+t.userInfo.followCount,placement:"right-start"}},[s("b",{staticClass:"follow_div_b"},[t._v(t._s(t.userInfo.followCount))])])],1)]),t._v(" "),s("b",{staticStyle:{"line-height":"50px",height:"50px","font-size":"30px"}},[t._v(t._s(t.userInfo.user.nickname))]),t._v(" "),s("div",{staticClass:"user_detail"},[s("div",{staticClass:"user_detail_value"},[t._v(t._s(t.userInfo.user.intro))])])])],1)]),t._v(" "),s("div",{staticClass:"activities_div_div user_card"},[s("div",{staticStyle:{"text-align":"center","border-bottom":"1px solid #ebebeb"}},[s("el-menu",{attrs:{"default-active":t.tabindex,mode:"horizontal"},on:{select:t.handleSelect}},t._l(t.menu,function(e,n){return s("el-menu-item",{key:n,attrs:{index:""+n}},[s("span",[t._v(t._s(e))])])}),1)],1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:"0"===t.tabindex,expression:"tabindex==='0'"},{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.load,expression:"load"}],staticClass:"activities_div",attrs:{"infinite-scroll-disabled":"loading"}},t._l(t.activityInfos,function(e,n){return s("div",{key:n},[s("ActivityInfo",{attrs:{activityInfo:e}}),t._v(" "),s("el-divider",{staticClass:"divider"})],1)}),0),t._v(" "),"1"===t.tabindex||"2"===t.tabindex?s("div",{staticClass:"activities_div"},t._l(t.questionActivityInfos,function(e,n){return s("div",{key:n},[s("ActivityInfo",{attrs:{activityInfo:e}}),t._v(" "),s("el-divider",{staticClass:"divider"})],1)}),0):t._e(),t._v(" "),"3"===t.tabindex?s("div",{staticClass:"activities_div"},t._l(t.subscribeQuestions,function(e,n){return s("div",{key:n},[s("ActivityInfo",{attrs:{activityInfo:e}}),t._v(" "),s("el-divider",{staticClass:"divider"})],1)}),0):t._e(),t._v(" "),"4"===t.tabindex||"5"===t.tabindex?s("div",[s("UserInfoTable",{attrs:{userInfos:t.userInfos}})],1):t._e()]),t._v(" "),s("el-dialog",{staticClass:"chat_dialog",attrs:{visible:t.showChat,"before-close":t.handleCloseChat},on:{"update:visible":function(e){t.showChat=e}}},[t.showChat?s("Chat",{attrs:{peopleUserInfo:t.userInfo}}):t._e()],1)],1):t._e()},staticRenderFns:[]};var I=s("VU/8")(v,p,!1,function(t){s("iavV")},null,null);e.default=I.exports},"5KsW":function(t,e,s){"use strict";var n=s("HUQg"),i={name:"AnswerInfo",components:{attitude:s("V7I/").a},props:["answerInfo"],data:function(){return{isShowAll:!1,answerStyle:{maxHeight:"200px"}}},mounted:function(){this.$refs.answer.scrollHeight<200&&(this.isShowAll=!0)},methods:{showAll:function(){this.isShowAll=!0;var t=this.$refs.answer;this.answerStyle.maxHeight=t.scrollHeight+"px"}}},r={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{ref:"answer",staticClass:"questionInfo_answer",style:t.answerStyle,domProps:{innerHTML:t._s(t.answerInfo.answer.ans)}}),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.isShowAll,expression:"!isShowAll"}],staticClass:"hide_all"},[s("el-button",{staticClass:"showAll_btn",attrs:{type:"text",icon:"el-icon-arrow-down"},on:{click:t.showAll}},[t._v("查看全文")])],1),t._v(" "),s("div",{staticStyle:{"margin-top":"10px"}},[s("attitude",{attrs:{answerInfo:t.answerInfo}})],1)])},staticRenderFns:[]};var o={name:"ActivityInfo",components:{AnswerInfo:s("VU/8")(i,r,!1,function(t){s("tdNp")},"data-v-708e9dbc",null).exports,userInfoSmall:n.a},data:function(){return{actionStrs:["关注了用户","提出了问题","关注了问题","关注了话题","回答了问题","赞同了回答"]}},props:["activityInfo"],methods:{toQuestion:function(){window.open(this.$router.resolve({path:"/question",query:{question_id:this.activityInfo.info.question_id,answer_id:this.answer_id}}).href,"_blank")}},computed:{actionStr:function(){return this.actionStrs[this.activityInfo.activity.act]},hasQuestion:function(){return-1!=[1,2,4,5].indexOf(this.activityInfo.activity.act)},hasAnswer:function(){return-1!=[4,5].indexOf(this.activityInfo.activity.act)},hasPeople:function(){return 0===this.activityInfo.activity.act},userInfo:function(){return this.activityInfo.userInfo},answerId:function(){return this.hasAnswer?this.activityInfo.info.defaultAnswer.answer.answerId:null}}},a={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticStyle:{"text-align":"left"}},[s("div",{staticStyle:{height:"30px","line-height":"30px"}},[t.userInfo?s("userInfoSmall",{staticStyle:{"margin-right":"10px"},attrs:{userInfo:t.userInfo}}):t._e(),t._v(" "),s("b",{staticStyle:{float:"left"}},[t._v(t._s(t.actionStr))]),t._v(" "),s("span",{staticClass:"gmt_create",staticStyle:{float:"right"}},[t._v(t._s(t.activityInfo.activity.gmtCreate))])],1),t._v(" "),!t.userInfo&&(t.hasPeople||t.hasAnswer||t.hasQuestion)?s("div",{staticStyle:{height:"30px"}},[t.hasPeople?s("userInfoSmall",{attrs:{userInfo:t.activityInfo.info}}):t.hasAnswer?s("userInfoSmall",{attrs:{userInfo:t.activityInfo.info.defaultAnswer.userInfo}}):s("userInfoSmall",{attrs:{userInfo:t.activityInfo.info.userInfo}})],1):t._e(),t._v(" "),t.hasQuestion?s("div",{staticClass:"question",staticStyle:{"margin-top":"10px"},on:{click:t.toQuestion}},[t._v(t._s(t.activityInfo.info.caption))]):t._e(),t._v(" "),t.hasAnswer?s("AnswerInfo",{staticStyle:{"margin-top":"10px"},attrs:{answerInfo:t.activityInfo.info.defaultAnswer}}):t._e()],1)},staticRenderFns:[]},u=s("VU/8")(o,a,!1,null,null,null);e.a=u.exports},"5PlU":function(t,e,s){var n=s("RY/4"),i=s("dSzd")("iterator"),r=s("/bQp");t.exports=s("FeBl").isIterable=function(t){var e=Object(t);return void 0!==e[i]||"@@iterator"in e||r.hasOwnProperty(n(e))}},BO1k:function(t,e,s){t.exports={default:s("fxRn"),__esModule:!0}},KANv:function(t,e){},SwPm:function(t,e){},Xd32:function(t,e,s){s("+tPU"),s("zQR9"),t.exports=s("5PlU")},d7EF:function(t,e,s){"use strict";e.__esModule=!0;var n=r(s("us/S")),i=r(s("BO1k"));function r(t){return t&&t.__esModule?t:{default:t}}e.default=function(){return function(t,e){if(Array.isArray(t))return t;if((0,n.default)(Object(t)))return function(t,e){var s=[],n=!0,r=!1,o=void 0;try{for(var a,u=(0,i.default)(t);!(n=(a=u.next()).done)&&(s.push(a.value),!e||s.length!==e);n=!0);}catch(t){r=!0,o=t}finally{try{!n&&u.return&&u.return()}finally{if(r)throw o}}return s}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},fxRn:function(t,e,s){s("+tPU"),s("zQR9"),t.exports=s("g8Ux")},g8Ux:function(t,e,s){var n=s("77Pl"),i=s("3fs2");t.exports=s("FeBl").getIterator=function(t){var e=i(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return n(e.call(t))}},iavV:function(t,e){},kX6x:function(t,e,s){"use strict";var n=s("yw6p"),i=(s("vMJZ"),{name:"UserInfoTable",props:["userInfos"],data:function(){return{pageSize:10,currentPage:1}},created:function(){console.log(this.userInfos)},computed:{userInfoDatas:function(){return this.userInfos.slice((this.currentPage-1)*this.pageSize,this.currentPage*this.pageSize)}},components:{UserInfo:n.a}}),r={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("el-card",{attrs:{"body-style":{padding:"10px"}}},[t._l(t.userInfoDatas,function(e){return s("div",{key:e.user.userId},[s("userInfo",{attrs:{userInfo:e}}),t._v(" "),s("el-divider",{staticClass:"divider"})],1)}),t._v(" "),s("el-pagination",{staticStyle:{"text-align":"center"},attrs:{"current-page":t.currentPage,"page-size":t.pageSize,layout:"total,prev, pager, next, jumper",total:t.userInfos.length},on:{"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e}}})],2)],1)},staticRenderFns:[]};var o=s("VU/8")(i,r,!1,function(t){s("KANv")},"data-v-3534e639",null);e.a=o.exports},tdNp:function(t,e){},"us/S":function(t,e,s){t.exports={default:s("Xd32"),__esModule:!0}}});
//# sourceMappingURL=1.4bd0b8b9cbf5c759b9b2.js.map